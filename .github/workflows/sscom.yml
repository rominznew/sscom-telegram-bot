name: SS.com Notifier

on:
  workflow_dispatch:       # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  schedule:
    - cron: "*/10 * * * *" # –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (UTC)

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: –°–∫–∞—á–∞—Ç—å –∫–æ–¥ –∏–∑ GitHub
        uses: actions/checkout@v3
        with:
          persist-credentials: true  # –≤–∞–∂–Ω–æ –¥–ª—è git push

      - name: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ git push
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ git remote..."
          git remote -v
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          # –ü—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—É—à –≤ –ø—É—Å—Ç—É—é –≤–µ—Ç–∫—É (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
          git commit --allow-empty -m "test-push" || echo "‚ùå –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          git push || echo "‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ git push ‚Äî –ø—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GITHUB_TOKEN"

      - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        run: |
          pip install -r requirements.txt

      - name: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
        run: python sscom_bot.py
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}

      - name: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π seen_ads.json
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add seen_ads.json
          git commit -m "Update seen_ads.json" || echo "‚ö†Ô∏è –ù–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"
          git push || echo "‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ git push"
